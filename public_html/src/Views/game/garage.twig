{% extends "/app/Resources/Views/gamebase.twig" %}

{% block stylesheets %}
<style type="text/css">
div.table-responsive.garage-shop-info > table {margin: 0;}
div.vehicle-info-container {margin:0 auto;max-width:500px;}
@media (max-width: 688px) {section#ccontainer section#content .row > .c-33, .row > .c-33 {width:100%;clear:both;}}
</style>
{% endblock stylesheets %}

{% block content %}
<div class="top">
    Garage
</div>
<div class="tab-container cf">
    <div class="tab {% if tab == 'vehicles' %}tab_on{% endif %} t-50">
        <a href="{{ routing.getRouteByRouteName('garage') }}">
            <img src="{{ staticRoot }}/foto/web/public/images/icons/car.png" class="icon" alt=""/> {{ langs.VEHICLES }}
        </a>
    </div>
    <div class="tab {% if tab == 'shop' %}tab_on{% endif %} t-50">
        <a href="{{ routing.getRouteByRouteName('garage-shop') }}">
            <img src="{{ staticRoot }}/foto/web/public/images/icons/car_add.png" class="icon" alt=""/> {{ langs.SHOP }}
        </a>
    </div>
</div>
<div class="content-container">
    <div class="c-row cf">
        <div class="inner-c-container">
        <div id="buyPossessResponse"></div>
            <div class="center">
                {% if possessionData.getPossessDetails.getUserID == 0 %}
                    <p>{{ langs.DEZETHIS }} {{ possessionData.getName|lower }} {{ langs.HAS_NO_OWNER_YET|lower }}</p>
                    <form id="possess_{{ possessionData.getId }}" class="ajaxForm" method="POST" action="{{ routing.getAjaxRouteByRouteName('interact-possession') }}" data-response="#buyPossessResponse">
                        <input type="hidden" name="id" value="{{ possessId }}"/>
                        <input type="hidden" name="security-token" value="{{ securityToken }}"/>
                        <input type="submit" name="buy" value="{% if lang == 'en' %}{{ langs.BUY }} {{ possessionData.getName|lower }}{% else %}{{ possessionData.getName|ucfirst }}{% endif %} {% if lang == 'nl' %}{{ langs.BUY|lower }} {% endif %}{{ langs.FOR|lower }} {{ possessionData.getPrice|moneyFormat }}"/>
                    </form>
                {% else %}
                    <p><a href="/game/profile/{{ possessionData.getPossessDetails.getUsername }}"><strong>{{ possessionData.getPossessDetails.getUsername }}</strong></a> {{ langs.IS_THE_OWNER_OF|lower }} {{ langs.DEZETHIS|lower }} <strong>{{ possessionData.getName|lower }}</strong>.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% include "/src/Views/game/tabs/garage/"~tab~".twig" %}
</div>
{% endblock content %}

{% block javascripts %}
<script type="text/javascript" src="{{ staticRoot }}/web/public/js/ajax-form.js"></script>
<script type="text/javascript">
$(document).on("change", ".garage-selection", function(e){
    $(".garage-selection").closest("form").submit();
});
$(document).ready(function(){
    $("a.action").click(function(e){
        $('#ajaxLoader').show();
        var vid = $(this).attr('data-id');
        var action = $(this).attr('data-action');
        var securityToken = $("input[name=security-token]").val();
        var postData = {action:action,id:vid,securityToken:securityToken};
        var formURL = '/game/garage/interact-vehicle';
        var method = "POST";
        var responseField = "#vehicleActionResponse_"+vid;
        $.ajax(
        {
        	url : formURL,
        	type: method,
        	data : postData,
        	success:function(data, textStatus, jqXHR) 
        	{
     	      if($("#ajaxLoader" ).length)
              {
                $('#ajaxLoader').hide();
              }
        	  $(responseField).html(data);
        	}
        });
        e.preventDefault();
    });
});
</script>
{% endblock javascripts %}
